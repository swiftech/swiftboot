# SwiftBoot-Web
Web 应用开发的核心模块，依赖于 SwiftBoot-Data。

## 依赖
* JDK >= 17
* Servlet >= 6.1
* Spring Framework >= 6.2.x
* Spring MVC >= 6.2.x
* Spring Boot >= 3.4.x
* Spring Data JPA >= 3.4.x


## 特性
* 接口参数自动填充到实体类中。
* 自动将实体类的属性值填充到返回值对象 DTO 中。
* 提供了统一的控制器（Controller）异常处理，自动将未处理的异常转换成 `JSON` 格式的接口响应对象返回给客户端。
* 自动处理接口参数验证结果，转换为 `JSON` 格式的统一格式；扩展的表单验证器，可验证：手机号，包含大写数字，包含数字，包含特殊符号。
* 统一固定的返回值格式:
  ```json
  {
    "code": "<4位的响应代码>",
    "message" : "<消息内容>",
    "data": {
      "自定义的JSON格式的返回数据对象"
    }
  }
  ```
* 支持 Java 8 的新的时间类型自动格式化。

## 快速开始

### 配置

* 配置

  ```java
  @Configuration
  @ComponentScan(basePackages = {"org.swiftboot.web", "org.swiftboot.data"})
  @EntityScan(basePackages = {"x.x.x"})
  @EnableJpaRepositories(basePackages = {"x.x.x"})
  public class MyConfig {
  }
  ```
 
### Model层
* Repository 接口

  ```java
  public interface OrderRepository extends CrudRepository<OrderEntity, String> {
  }
  ```

* 实体类定义

  ```java
  @Entity
  @Table(name = "DEMO_ORDER")
  public class OrderEntity extends BaseIdEntity {
      /**
       * 订单编号
       */
      @Column(name = "ORDER_CODE", length = 16)
      private String orderCode;

      /**
       * 订单描述
       */
      @Column(name = "DESCRIPTION", length = 64)
      private String description;
  }
  ```

[详细参考](../swiftboot-data/README.md)

### 控制器 Controller

* 接口输入参数和返回值
  `POST`, `PUT` 和 `PATCH` 接口的所有输入参数对象继承 `HttpRequest` 或者它的子类。 所有的控制器接口返回统一定义的响应对象 `Response`，包含错误代码、错误消息以及泛型表达的接口返回值。

  例如一个创建订单的接口如下：
  ```java
  @PostMapping("order/create")
  public
  @ResponseBody Response<OrderCreateDto> orderCreate(
          @RequestBody @Validated @ApiParam("创建订单参数") OrderCreateRequest request) {
      OrderCreateDto ret = orderService.createOrder(request);
      return new Response<>(ret);
  }
  ```

  ```java
  public class OrderCreateRequest extends BasePopulateRequest<OrderEntity> {
    @JsonProperty("order_code")
    @Length(max = 16)
    private String orderCode;

    @JsonProperty("description")
    @Length(max = 64)
    private String description;
  }
  ```

  ```java
  public class OrderCreateDto extends BasePopulateDto<OrderEntity> {
    @JsonProperty("order_id")
    private String orderId;
  }
  ```

> `@ResponseBody` 注解会把接口方法返回的 `Response` 对象及其内嵌的对象一起转换成 JSON 格式返回给访问接口的客户端。


### Service 层

Web 开发中最无趣的工作之一就是从接口参数对象中复制每个参数值到 Model 层的实体类中进行保存，反之亦然。 SwiftBoot 实现了自动化的参数填充，它能够有选择性的将参数值填充到对应的实体类中，也能将实体类中的值填充到返回值对象中（如果实体类关联了其他实体类对象，它也会对应的填充到返回值对象的内嵌对象中去）。

* 输入参数自动填充实现方法：
  * 输入参数对象继承 `BasePopulateRequest`，并指定范型类型为对应的实体类的类型。
  * 对于新增数据的操作，调用 `createEntity()` 方法即可实例化相对应的实体类，并把输入参数对象中所有名称对应的值填充到实体类中。对于用 `@OneToOne` 和 `@OneToMany` 注解标注的子类或者子集合也会被自动填充。
  * 对于修改数据的操作，查询出需要修改的实体类之后，调用 `populateEntity()` 方法将输入参数对象中所有名称对应的值填充到实体类中。 对于用 `@OneToOne` 和 `@OneToMany` 注解标注的子类或者子集合也会被自动填充。

* 输出参数自动填充实现方法：
  * 返回值对象 DTO 需要继承 `BasePopulateDto`
  * 在需要创建 DTO 实例的地方调用 `BasePopulateDto` 的静态方法 `createDto()` 即可实例化 DTO，并把将查询到的实体类中所有对应名称的值填充到输出对象中。或者在代码中直接实例化 DTO 实例，然后调用它的 `populateByEntity()` 方法进行填充。
  * 如果实体类定义了一对一、一对多关联，那么 DTO 类也可以定义相应的关联关系（变量名相同），这样的关联对象也会被自动填充
  * 有时候虽然 DTO 对象之间定义了关联关系，但是你可能不希望在所有的场景下都自动的填充关联的对象，那么 `populateByEntity()` 方法提供了一个 `includeRelation` 可以覆盖默认的填充行为，只对当前 DTO 类的属性进行填充，而不会处理关联对象。

* 创建和查询代码示例：


  ```java
  @Service
  public class OrderServiceImpl implements OrderService {
    @Override
    public OrderCreateDto createOrder(OrderCreateRequest request) {
        OrderEntity p = request.createEntity();
        p.setId(IdUtils.makeUUID()); // 如果设置了自动生成 ID 就不需要这一行代码
        OrderEntity saved = orderRepository.save(p);
        return new OrderCreateDto(saved.getId());
    }

    @Override
    public OrderDto queryOrder(String orderId) {
        Optional<OrderEntity> optEntity = orderRepository.findById(orderId);
        if (optEntity.isPresent()) {
            return OrderDto.createDto(OrderDto.class, optEntity.get());
        }
        return null;
    }
  }
  ```

  输入参数对象类定义：
  ```java
  public class OrderCreateRequest extends BasePopulateRequest<OrderEntity> {

    @JsonProperty("order_code")
    @Length(max = 16)
    private String orderCode;

    @JsonProperty("description")
    @Length(max = 64)
    private String description;
  }
  ```

  返回对象类定义：
  ```java
  public class OrderDto extends BasePopulateDto {
    @JsonProperty("order_code")
    private String orderCode;

    @JsonProperty("description")
    private String description;
  }
  ```

更多高级特性参考: [v3_advanced.md](v3_advanced.md)